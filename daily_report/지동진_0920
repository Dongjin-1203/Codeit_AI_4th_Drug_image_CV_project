# 지동진_0920_일일 보고서: Phase 1 신뢰도 임계값 최적화 분석 보고서

## 1. Phase 1 목표 및 배경

### 1.1 초기 문제 인식
RT-DETR 모델의 초기 성능 분석 결과, 다음과 같은 문제점이 확인되었습니다:

**성능 지표 분석:**
- mAP50: 36.1% (보통 수준)
- **Precision: 25.3% (심각하게 낮음)**
- **Recall: 99.5% (과도하게 높음)**
- 제출 점수: 0.958

**초기 가정:**
- 낮은 Precision이 주요 문제
- 과도한 거짓 양성 탐지로 인한 성능 저하
- 신뢰도 임계값 상향 조정을 통한 Precision 개선 필요

### 1.2 Phase 1 전략 수립
**목표:** Precision 25% → 45% 향상을 통한 전체 성능 개선

**실행 계획:**
1. 신뢰도 임계값 0.25 → 0.4 상향 조정
2. NMS 임계값 최적화 (0.7 → 0.5)
3. 최소 박스 크기 필터링 적용
4. 거짓 양성 탐지 감소를 통한 정밀도 향상

## 2. Phase 1 실험 설계 및 실행

### 2.1 실험 설정
**기준 모델 (Baseline):**
- 모델: RT-DETR-L
- 신뢰도 임계값: 0.25
- NMS 임계값: 기본값 (0.7)
- 예측 결과: 3,307개 탐지
- 제출 점수: 0.958

**개선 모델 (Phase 1):**
- 모델: RT-DETR-L (동일)
- 신뢰도 임계값: 0.4 (상향 조정)
- NMS 임계값: 0.5 (최적화)
- 예측 결과: 888개 탐지
- 제출 점수: 0.264

### 2.2 구현된 개선사항

#### 신뢰도 임계값 조정
```python
# 기존 설정
results = self.model(img_path, conf=0.25)

# Phase 1 개선
results = self.model(img_path, conf=0.4)
```

#### NMS 임계값 최적화
```python
# 중복 탐지 제거 강화
self.model.overrides['iou'] = 0.5  # 기본 0.7에서 0.5로 낮춤
self.model.overrides['max_det'] = 100  # 최대 탐지 수 제한
```

#### 최소 박스 크기 필터링
```python
# 너무 작은 탐지 제거
min_box_size = 10
if bbox_w < min_box_size or bbox_h < min_box_size:
    continue
```

## 3. Phase 1 실험 결과 분석

### 3.1 정량적 결과 비교

| 지표 | Baseline (0.25) | Phase 1 (0.4) | 변화율 |
|------|-----------------|---------------|--------|
| **제출 점수** | 0.958 | 0.264 | **-72.4%** |
| **예측 수** | 3,307개 | 888개 | **-73.1%** |
| **mAP50** | 36.1% | 36.1% | 0% (동일) |
| **mAP50-95** | 36.1% | 36.1% | 0% (동일) |
| **Precision** | 25.3% | 추정 45%+ | +20%+ |
| **Recall** | 99.5% | 추정 70%- | -30%- |

### 3.2 예측 결과 시각화 분석
**Baseline (임계값 0.25):**
- 신뢰도 범위: 0.3-0.6
- 탐지 결과: 대부분 알약이 탐지됨
- 거짓 양성: 다수 존재하지만 실제 객체도 포함

**Phase 1 (임계값 0.4):**
- 신뢰도 범위: 0.4-0.6
- 탐지 결과: 고신뢰도 객체만 탐지
- 거짓 양성: 감소했으나 **실제 객체도 대량 누락**

### 3.3 핵심 발견사항

#### 발견 1: 평가 방식의 재해석
**기존 가정 (틀렸음):**
- "낮은 Precision이 문제 → 거짓 양성 제거 필요"

**실제 발견:**
- **평가 방식이 Recall 중심**
- mAP@[0.75:0.95] 평가에서는 모든 객체 탐지가 우선
- 점수 감소율(-72.4%)과 예측 감소율(-73.1%)이 거의 일치

#### 발견 2: 모델 특성 이해
- 현재 모델은 이미 **적절한 균형점**에 위치
- Recall 99.5%는 "과탐지"가 아닌 "완전 탐지"
- 임계값 0.25에서 최적 성능 달성

#### 발견 3: 성능 저하 원인 분석
- **Recall 손실이 성능 저하의 주원인**
- 73% 예측 감소 = 실제 존재하는 알약의 대량 누락
- Precision 향상보다 Recall 유지가 더 중요

## 4. Phase 1 결론 및 교훈

### 4.1 주요 결론

#### 임계값 최적화 완료
- **최적 신뢰도 임계값: 0.25 확정**
- 추가 상향 조정은 오히려 성능 저하
- 현재 설정이 이미 최적화됨

#### 평가 방식 특성 파악
- **Recall 중심 평가 시스템**
- 모든 객체를 찾는 것이 정밀도보다 우선
- "놓치지 않는 것"이 "정확하게 찾는 것"보다 중요

#### 모델 개선 방향 재설정
- 임계값 조정으로는 추가 개선 한계
- **데이터 품질 및 모델 용량 개선 필요**
- 구조적 접근이 필요한 시점

### 4.2 Phase 1 교훈

#### 성공 요인
1. **체계적 실험 설계**: 정량적 비교 분석
2. **다각도 검증**: 점수, 예측 수, 시각화 종합 분석
3. **가정 검증**: 초기 가정의 오류 발견

#### 실패 요인
1. **평가 방식 오해**: Precision 중심 사고의 한계
2. **도메인 특성 간과**: 의료 분야에서 Recall의 중요성
3. **성급한 최적화**: 근본 원인 분석 부족

#### 방법론적 개선점
1. **평가 지표 우선순위 재정립**
2. **도메인 특성 반영한 전략 수립**
3. **단계별 가설 검증 프로세스 강화**

## 5. Phase 2 전략 및 계획

### 5.1 새로운 문제 정의
**Phase 1 이후 재정의된 문제:**
- 임계값은 이미 최적화됨
- **근본적 성능 향상을 위한 구조적 개선 필요**
- 데이터 불균형 및 모델 용량이 주요 제약

### 5.2 Phase 2 우선순위 전략

#### 우선순위 1: 클래스 불균형 해결
**현재 상황:**
- 일부 클래스: 200+ 샘플
- 일부 클래스: 10개 미만 샘플
- 혼동행렬에서 클래스별 성능 편차 확인

**개선 방안:**
- 소수 클래스 데이터 증강 (회전, 색상 변경, 크롭)
- 클래스별 가중치 조정
- 균형잡힌 샘플링 전략

#### 우선순위 2: 모델 용량 확장
**현재 제약:**
- RT-DETR-L 모델의 용량 한계
- 640×640 해상도의 세부 정보 손실

**개선 방안:**
- RT-DETR-L → RT-DETR-X 업그레이드
- 이미지 해상도 640 → 1024 증가
- 백본 네트워크 강화

#### 우선순위 3: 고급 최적화 기법
**적용 계획:**
- 학습률 스케줄링 최적화
- Focal Loss 적용 (클래스 불균형 대응)
- 앙상블 기법 도입

### 5.3 예상 성능 향상 목표

| Phase | 주요 개선사항 | 목표 점수 | 예상 향상률 |
|-------|---------------|-----------|-------------|
| Baseline | - | 0.958 | - |
| **Phase 2** | 클래스 불균형 해결 | 1.05+ | +10% |
| **Phase 3** | 모델 용량 확장 | 1.15+ | +20% |
| **Phase 4** | 고급 최적화 | 1.25+ | +30% |

## 6. 결론 및 향후 방향

### 6.1 Phase 1 종합 평가
Phase 1은 **예상과 반대의 결과**를 통해 중요한 인사이트를 제공했습니다. 임계값 최적화 시도는 실패했지만, 이를 통해 **평가 방식의 특성과 모델의 현재 상태**를 정확히 파악할 수 있었습니다.

**핵심 성과:**
- 최적 임계값 확정 (0.25)
- 평가 방식 특성 파악 (Recall 중심)
- 다음 개선 방향 명확화

### 6.2 Phase 2 실행 준비도
Phase 1의 교훈을 바탕으로 Phase 2는 **구조적 개선**에 집중합니다:

**즉시 실행 가능:**
- 클래스 불균형 분석 및 데이터 증강
- RT-DETR-X 모델로 업그레이드
- 고해상도 학습 환경 구축

**예상 도전과제:**
- 컴퓨팅 리소스 증가 (고해상도, 큰 모델)
- 학습 시간 연장
- 하이퍼파라미터 재조정 필요

### 6.3 방법론적 기여
이번 Phase 1 분석은 **객체 탐지 모델 최적화 방법론**에 다음과 같은 기여를 했습니다:

1. **평가 지표 우선순위의 중요성**: 도메인에 따른 Precision vs Recall 가중치
2. **가정 검증의 필요성**: 직관적 판단의 한계와 실험적 검증의 가치
3. **단계적 최적화 전략**: 임계값 → 데이터 → 모델 순서의 효율성

---
*작성자: 지동진*  
*분석 기간: 2025년 9월 19일 - 9월 20일*  
*Phase 1 완료일: 2025년 9월 20일*  
*다음 단계: Phase 2 클래스 불균형 해결*
